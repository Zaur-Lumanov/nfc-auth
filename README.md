# NFC-Auth

Программа для шифрования и расшифровки данных с использованием NFC-карт. Использует UID или ATR карты вместе с PIN-кодом для генерации ключа шифрования.

## Требования

- Go 1.16 или выше
- NFC-ридер, поддерживающий PC/SC (например, ACR1252)
- Установленный PC/SC драйвер для вашей операционной системы

### Установка PC/SC

#### macOS
```bash
brew install pcsc-lite
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt-get install pcscd libpcsclite-dev
```

#### Windows
- Установите драйверы для вашего NFC-ридера
- Установите [pcsc-lite для Windows](https://github.com/LudovicRousseau/pcsclite/releases)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/nfc-auth.git
cd nfc-auth
```

2. Установите зависимости:
```bash
go mod download
```

## Использование

Программа поддерживает несколько режимов работы:

### 1. Шифрование данных

По умолчанию используется ATR карты:
```bash
go run main.go encode "данные для шифрования"
```

Использование UID карты (с флагом --uid):
```bash
go run main.go encode --uid "данные для шифрования"
```

### 2. Расшифровка данных

```bash
go run main.go decode "ATR:зашифрованные_данные"
# или
go run main.go decode "UID:зашифрованные_данные"
```

### 3. Режимы отладки

Мониторинг UID карт:
```bash
go run main.go dbg
```

Мониторинг ATR карт:
```bash
go run main.go dbg2
```

## Особенности

- **Шифрование**: Использует AES-256 в режиме CBC
- **Ключ**: Генерируется на основе:
  - UID или ATR карты (выбирается при шифровании)
  - PIN-кода (может быть пустым)
  - Глобальной соли
- **Формат данных**: Зашифрованные данные кодируются в base64 и содержат префикс (ATR: или UID:)
- **PIN-код**: Можно использовать пустой PIN-код (просто нажмите Enter при запросе)

## Примеры использования

1. Шифрование с использованием ATR и PIN-кода:
```bash
$ go run main.go encode "Секретное сообщение"
Подключение к ридеру: ACS ACR1252 1S CL Reader
Ожидание карты...
Карта обнаружена! ATR: 3B8F8001804F0CA0000003060300030000000068
Введите PIN-код (или нажмите Enter для пустого PIN-кода): 1234
Зашифрованные данные: ATR:base64_encoded_data...
```

2. Расшифровка данных:
```bash
$ go run main.go decode "ATR:base64_encoded_data..."
Подключение к ридеру: ACS ACR1252 1S CL Reader
Ожидание карты...
Карта обнаружена! ATR: 3B8F8001804F0CA0000003060300030000000068
Введите PIN-код (или нажмите Enter для пустого PIN-кода): 1234
Расшифрованные данные: Секретное сообщение
```

3. Мониторинг карт:
```bash
$ go run main.go dbg
Подключение к ридеру: ACS ACR1252 1S CL Reader
Режим отладки (UID): ожидание карт...
Нажмите Ctrl+C для выхода
Карта обнаружена! UID: 04A3B2C1D0E9F8
```

## Безопасность

- Используется криптографически стойкий алгоритм AES-256
- Ключ генерируется с использованием SHA-256
- Каждое шифрование использует уникальный IV
- PIN-код не хранится в открытом виде
- Глобальная соль добавляет дополнительный уровень безопасности

## Ограничения

- Для расшифровки требуется та же карта, что использовалась при шифровании
- Необходимо знать PIN-код, использованный при шифровании
- Поддерживаются только NFC-карты, совместимые с PC/SC

## Устранение неполадок

1. **Ридер не определяется**:
   - Убедитесь, что PC/SC драйвер установлен и запущен
   - Проверьте подключение ридера
   - Перезапустите службу PC/SC

2. **Ошибка при чтении карты**:
   - Убедитесь, что карта поддерживается
   - Проверьте, что карта правильно размещена на ридере
   - Попробуйте использовать другую карту

3. **Ошибка расшифровки**:
   - Убедитесь, что используется та же карта
   - Проверьте правильность PIN-кода
   - Проверьте формат зашифрованных данных

## Лицензия

MIT License 